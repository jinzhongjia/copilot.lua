# NES Jump Functionality - 跳转功能增强

## 功能概述

NES (Next Edit Suggestions) 现在支持显示和跳转到缓冲区中任意位置的建议，不再局限于当前光标位置。

## 主要特性

### 1. 远程建议显示
- **位置无关性**: 建议可以出现在缓冲区的任何位置
- **视觉区分**: 远程建议使用不同的高亮样式（粗体斜体）
- **位置指示器**: 远程建议显示 `[L#]` 行号前缀

### 2. 智能跳转功能
- **自动跳转**: 接受建议时自动跳转到建议位置
- **手动跳转**: 使用 `<C-g>` 键手动跳转到当前建议
- **光标定位**: 精确跳转到建议的起始位置

### 3. 增强的显示系统
- **Ghost Text**: 使用虚拟文本显示建议内容
- **范围高亮**: 高亮显示将被替换的文本范围
- **主题适配**: 自动适配不同的颜色主题

## 高亮组

### 新增高亮组
- `CopilotNESGhost`: 本地建议（光标附近）
- `CopilotNESGhostRemote`: 远程建议（粗体斜体）
- `CopilotNESRange`: 范围高亮
- `CopilotNESLocation`: 位置指示器

### 颜色方案
- 链接到系统高亮组，确保主题兼容性
- `Comment` + 斜体样式用于 ghost text
- `CursorLine` 用于范围高亮

## 键盘映射

### 新增键盘映射
- `<C-g>`: 跳转到当前建议位置（插入模式和普通模式）

### 现有映射
- `<C-j>`: 接受当前建议（现在会自动跳转）
- `<C-k>`: 拒绝当前建议
- `<C-l>`: 下一个建议
- `<C-h>`: 上一个建议
- `<leader>cn`: 切换 NES 开关

## 使用示例

### 场景 1: 当前位置建议
```
// 在这里输入时，建议直接显示
function test() |
```
显示: `console.log('Hello');` (正常斜体)

### 场景 2: 远程位置建议
```
function test() {
  // 当前光标在这里 |
}

// 建议出现在其他位置
function anotherFunction() {
  [L15] return someValue; // 粗体斜体，带行号
}
```

## 配置选项

### display 配置
```lua
display = {
  max_suggestions = 3,
  auto_show = true,
  ghost_text_enabled = true,  -- 启用 ghost text
}
```

### keymaps 配置
```lua
keymaps = {
  accept = "<C-j>",
  reject = "<C-k>", 
  next = "<C-l>",
  prev = "<C-h>",
  toggle = "<leader>cn",
  jump = "<C-g>",  -- 新增跳转键
}
```

## 工作流程

1. **建议生成**: LSP 服务器发送位置不限的建议
2. **智能显示**: 根据建议位置选择显示样式
3. **用户交互**: 
   - 浏览建议: `<C-l>` / `<C-h>`
   - 跳转查看: `<C-g>`
   - 接受建议: `<C-j>` (自动跳转并应用)
   - 拒绝建议: `<C-k>`

## 技术实现

### 显示逻辑
- 使用 `nvim_buf_set_extmark` 和 `virt_text` 
- 检测光标距离建议位置的关系
- 动态选择高亮组和显示格式

### 跳转逻辑
- 精确的坐标转换（0-based ↔ 1-based）
- `nvim_win_set_cursor` 实现光标跳转
- 与文本编辑操作的协调

### 清理机制
- 光标移动过远时自动清理
- 离开插入模式时清理
- 新建议出现时清理旧显示

## 兼容性

- ✅ 兼容所有 Neovim 颜色主题
- ✅ 保持与现有 Copilot 功能的兼容
- ✅ 支持多行建议的智能显示
- ✅ 适配不同屏幕尺寸

这个增强使得 NES 能够处理更复杂的代码编辑场景，提供更智能的建议定位和导航功能。